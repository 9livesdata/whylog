notifications:
  slack: 9livesdatazpp:ASnedOwaNFG6eXFs15Iw6dpd#travis

language: python
python:
  - "2.6"
  - "2.7"
  - "3.2"
  - "3.3"
  - "3.4"
  - "3.5"
  - "nightly"
  - "pypy"
  - "pypy3"

matrix:
  include:
    - python: "2.7"
      env: JYTHON=true
    - python: "2.7"
      env: YAPF=true
    - python: "3.5"
      env: YAPF=true

before_install:
  - uname -a
  - lsb_release -a
  - virtualenv --version
  # get jython
  - if [ -n "$JYTHON" ]; then wget http://search.maven.org/remotecontent?filepath=org/python/jython-installer/2.7.0/jython-installer-2.7.0.jar -O jython-installer-2.7.0.jar; fi
  - if [ -n "$JYTHON" ]; then java -jar jython-installer-2.7.0.jar --silent --directory $HOME/jython; fi
  # create jython virtualenv
  - if [ -n "$JYTHON" ]; then virtualenv --system-site-packages -p $HOME/jython/bin/jython $HOME/.virtualenv/jython; fi
  - if [ -n "$JYTHON" ]; then source $HOME/.virtualenv/jython/bin/activate; fi
  # easy install works on jython (pip does not seem to, jip violates .virtualenv sandbox...)
  - if [ -n "$JYTHON" ]; then wget http://peak.telecommunity.com/dist/ez_setup.py; fi
  - if [ -n "$JYTHON" ]; then python ez_setup.py ; fi
  - python --version

install:
  - if [ -n "$JYTHON" ]; then easy_install nose; fi
  - if [ -n "$JYTHON" ]; then easy_install test-generator; fi
  - if [ ! -n "$JYTHON" ]; then pip --version; fi
  - if [ ! -n "$JYTHON" ]; then pip install -r requirements.txt; fi
  - if [ ! -n "$JYTHON" ]; then pip install -r requirements-test.txt; fi
  - if [ -n "$YAPF" ]; then python setup.py develop; fi

before_script:
  # Before runing the test case, we need to make jython run some code as in first run it can put something on stdout
  - if [ -n "$JYTHON" ]; then python -c "print ''"; fi

script:
  - if [ -n "$YAPF" ]; then yapf --diff --recursive .; exit; fi
  - python setup.py nosetests
